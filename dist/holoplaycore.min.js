(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports):typeof define==="function"&&define.amd?define(["exports"],t):(e=e||self,t(e.HoloPlayCore={}))})(this,(function(e){"use strict";var t=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function n(e,t){return t={exports:{}},e(t,t.exports),t.exports}var r=n((function(e){(function(t,n){var r=Math.pow(2,-24),s=Math.pow(2,32),i=Math.pow(2,53);function a(e){var t=new ArrayBuffer(256);var r=new DataView(t);var a;var o=0;function u(e){var n=t.byteLength;var s=o+e;while(n<s)n*=2;if(n!==t.byteLength){var i=r;t=new ArrayBuffer(n);r=new DataView(t);var u=o+3>>2;for(var l=0;l<u;++l)r.setUint32(l*4,i.getUint32(l*4))}a=e;return r}function l(){o+=a}function f(e){l(u(8).setFloat64(o,e))}function c(e){l(u(1).setUint8(o,e))}function h(e){var t=u(e.length);for(var n=0;n<e.length;++n)t.setUint8(o+n,e[n]);l()}function d(e){l(u(2).setUint16(o,e))}function p(e){l(u(4).setUint32(o,e))}function g(e){var t=e%s;var n=(e-t)/s;var r=u(8);r.setUint32(o,n);r.setUint32(o+4,t);l()}function w(e,t){if(t<24){c(e<<5|t)}else if(t<256){c(e<<5|24);c(t)}else if(t<65536){c(e<<5|25);d(t)}else if(t<4294967296){c(e<<5|26);p(t)}else{c(e<<5|27);g(t)}}function v(e){var t;if(e===false)return c(244);if(e===true)return c(245);if(e===null)return c(246);if(e===n)return c(247);switch(typeof e){case"number":if(Math.floor(e)===e){if(0<=e&&e<=i)return w(0,e);if(-i<=e&&e<0)return w(1,-(e+1))}c(251);return f(e);case"string":var r=[];for(t=0;t<e.length;++t){var s=e.charCodeAt(t);if(s<128){r.push(s)}else if(s<2048){r.push(192|s>>6);r.push(128|s&63)}else if(s<55296){r.push(224|s>>12);r.push(128|s>>6&63);r.push(128|s&63)}else{s=(s&1023)<<10;s|=e.charCodeAt(++t)&1023;s+=65536;r.push(240|s>>18);r.push(128|s>>12&63);r.push(128|s>>6&63);r.push(128|s&63)}}w(3,r.length);return h(r);default:var a;if(Array.isArray(e)){a=e.length;w(4,a);for(t=0;t<a;++t)v(e[t])}else if(e instanceof Uint8Array){w(2,e.length);h(e)}else{var o=Object.keys(e);a=o.length;w(5,a);for(t=0;t<a;++t){var u=o[t];v(u);v(e[u])}}}}v(e);if("slice"in t)return t.slice(0,o);var y=new ArrayBuffer(o);var b=new DataView(y);for(var m=0;m<o;++m)b.setUint8(m,r.getUint8(m));return y}function o(e,t,i){var a=new DataView(e);var o=0;if(typeof t!=="function")t=function(e){return e};if(typeof i!=="function")i=function(){return n};function u(e,t){o+=t;return e}function l(t){return u(new Uint8Array(e,o,t),t)}function f(){var e=new ArrayBuffer(4);var t=new DataView(e);var n=p();var s=n&32768;var i=n&31744;var a=n&1023;if(i===31744)i=255<<10;else if(i!==0)i+=127-15<<10;else if(a!==0)return a*r;t.setUint32(0,s<<16|i<<13|a<<13);return t.getFloat32(0)}function c(){return u(a.getFloat32(o),4)}function h(){return u(a.getFloat64(o),8)}function d(){return u(a.getUint8(o),1)}function p(){return u(a.getUint16(o),2)}function g(){return u(a.getUint32(o),4)}function w(){return g()*s+g()}function v(){if(a.getUint8(o)!==255)return false;o+=1;return true}function y(e){if(e<24)return e;if(e===24)return d();if(e===25)return p();if(e===26)return g();if(e===27)return w();if(e===31)return-1;throw"Invalid length encoding"}function b(e){var t=d();if(t===255)return-1;var n=y(t&31);if(n<0||t>>5!==e)throw"Invalid indefinite length element";return n}function m(e,t){for(var n=0;n<t;++n){var r=d();if(r&128){if(r<224){r=(r&31)<<6|d()&63;t-=1}else if(r<240){r=(r&15)<<12|(d()&63)<<6|d()&63;t-=2}else{r=(r&15)<<18|(d()&63)<<12|(d()&63)<<6|d()&63;t-=3}}if(r<65536){e.push(r)}else{r-=65536;e.push(55296|r>>10);e.push(56320|r&1023)}}}function C(){var e=d();var r=e>>5;var s=e&31;var a;var o;if(r===7){switch(s){case 25:return f();case 26:return c();case 27:return h()}}o=y(s);if(o<0&&(r<2||6<r))throw"Invalid length";switch(r){case 0:return o;case 1:return-1-o;case 2:if(o<0){var u=[];var p=0;while((o=b(r))>=0){p+=o;u.push(l(o))}var g=new Uint8Array(p);var w=0;for(a=0;a<u.length;++a){g.set(u[a],w);w+=u[a].length}return g}return l(o);case 3:var q=[];if(o<0){while((o=b(r))>=0)m(q,o)}else m(q,o);return String.fromCharCode.apply(null,q);case 4:var U;if(o<0){U=[];while(!v())U.push(C())}else{U=new Array(o);for(a=0;a<o;++a)U[a]=C()}return U;case 5:var x={};for(a=0;a<o||o<0&&!v();++a){var M=C();x[M]=C()}return x;case 6:return t(C(),o);case 7:switch(o){case 20:return false;case 21:return true;case 22:return null;case 23:return n;default:return i(o)}}}var q=C();if(o!==e.byteLength)throw"Remaining bytes";return q}var u={encode:a,decode:o};if(typeof n==="function"&&n.amd)n("cbor/cbor",u);else if(e.exports)e.exports=u;else if(!t.CBOR)t.CBOR=u})(t)}));
/**
	 * This files defines the HoloPlayClient class and Message class.
	 *
	 * Copyright (c) [2019] [Looking Glass Factory]
	 *
	 * @link    https://lookingglassfactory.com/
	 * @file    This files defines the HoloPlayClient class and Message class.
	 * @author  Looking Glass Factory.
	 * @version 0.0.8
	 * @license SEE LICENSE IN LICENSE.md
	 */const s=typeof window==="undefined"?require("ws"):window.WebSocket;class i{constructor(e,t,n,r=false,s,i,a){this.reqs=[];this.reps=[];this.requestId=this.getRequestId();this.debug=r;this.isGreedy=i;this.errCallback=t;this.closeCallback=n;this.alwaysdebug=false;this.isConnected=false;let u=null;if(s||i||a){u=new o(s,i,a,this.debug)}else{if(r)this.alwaysdebug=true;if(typeof e=="function")u=new c}this.openWebsocket(u,e)}sendMessage(e,t=60){if(this.alwaysdebug)e.cmd.debug=true;let n=e.toCbor();return this.sendRequestObj(n,t)}disconnect(){this.ws.close()}openWebsocket(e=null,t=null){this.ws=new s("ws://localhost:11222/driver",["rep.sp.nanomsg.org"]);this.ws.parent=this;this.ws.binaryType="arraybuffer";this.ws.onmessage=this.messageHandler;this.ws.onopen=()=>{this.isConnected=true;if(this.debug){console.log("socket open")}if(e!=null){this.sendMessage(e).then(t)}};this.ws.onerror=this.onSocketError;this.ws.onclose=this.onClose}sendRequestObj(e,t){return new Promise((n,r)=>{let s={id:this.requestId++,parent:this,payload:e,success:n,error:r,send:function(){if(this.debug)console.log("attemtping to send request with ID "+this.id);this.timeout=setTimeout(s.send.bind(this),t*1e3);let n=new Uint8Array(e.byteLength+4);let r=new DataView(n.buffer);r.setUint32(0,this.id);n.set(new Uint8Array(this.payload),4);this.parent.ws.send(n.buffer)}};this.reqs.push(s);s.send()})}messageHandler(e){console.log("message");let t=e.data;if(t.byteLength<4)return;let n=new DataView(t);let s=n.getUint32(0);if(s<2147483648){this.parent.err("bad nng header");return}let i=this.parent.findReqIndex(s);if(i==-1){this.parent.err("got reply that doesn't match known request!");return}let a={id:s,payload:r.decode(t.slice(4))};if(a.payload.error==0){this.parent.reqs[i].success(a.payload)}else{this.parent.reqs[i].error(a.payload)}clearTimeout(this.parent.reqs[i].timeout);this.parent.reqs.splice(i,1);this.parent.reps.push(a);if(this.debug){console.log(a.payload)}}getRequestId(){return Math.floor(this.prng()*2147483647)+2147483648}onClose(e){this.parent.isConnected=false;if(this.parent.debug){console.log("socket closed")}if(typeof this.parent.closeCallback=="function")this.parent.closeCallback(e)}onSocketError(e){if(this.parent.debug){console.log(e)}if(typeof this.parent.errCallback=="function"){this.parent.errCallback(e)}}err(e){if(this.debug){console.log("[DRIVER ERROR]"+e)}}findReqIndex(e){let t=0;for(;t<this.reqs.length;t++){if(this.reqs[t].id==e){return t}}return-1}prng(){if(this.rng==undefined){this.rng=v()}return this.rng()}}class a{constructor(e,t){this.cmd=e;this.bin=t}toCbor(){return r.encode(this)}}class o extends a{constructor(e="",t=false,n="",r=false){let s={init:{}};if(e!="")s["init"].appid=e;if(n!="")s["init"].onclose=n;if(t)s["init"].greedy=true;if(r)s["init"].debug=true;super(s,null)}}class u extends a{constructor(e=""){let t={delete:{name:e}};super(t,null)}}class l extends a{constructor(e=""){let t={check:{name:e}};super(t,null)}}class f extends a{constructor(e=null){let t={wipe:{}};if(e!=null)t["wipe"].targetDisplay=e;super(t,null)}}class c extends a{constructor(){let e={info:{}};super(e,null)}}class h extends a{constructor(){let e={uniforms:{}};super(e,bindata)}}class d extends a{constructor(){let e={shader:{}};super(e,bindata)}}class p extends a{constructor(e={vx:5,vy:9,aspect:1.6},t="",n=null){let r={show:{source:"bindata",quilt:{type:"image",settings:e}}};if(n!=null)r["show"]["targetDisplay"]=n;super(r,t)}}class g extends a{constructor(e,t={vx:5,vy:9,aspect:1.6},n="",r=false){let s={cache:{show:r,quilt:{name:e,type:"image",settings:t}}};super(s,n)}}class w extends a{constructor(e,t=null,n=null){let r={show:{source:"cache",quilt:{name:e}}};if(t!=null)r["show"]["targetDisplay"]=t;if(n!=null)r["show"]["quilt"].settings=n;super(r,null)}}function v(){function e(e){for(var t=0,n=1779033703^e.length;t<e.length;t++)n=Math.imul(n^e.charCodeAt(t),3432918353),n=n<<13|n>>>19;return function(){n=Math.imul(n^n>>>16,2246822507);n=Math.imul(n^n>>>13,3266489909);return(n^=n>>>16)>>>0}}function t(e,t,n,r){return()=>{var s=t<<9,i=e*5;i=(i<<7|i>>>25)*9;n^=e;r^=t;t^=n;e^=r;n^=s;r=r<<11|r>>>21;return(i>>>0)/4294967296}}var n=Date.now();var r=e(n.toString());return t(r(),r(),r(),r())}e.CacheMessage=g;e.CheckMessage=l;e.Client=i;e.DeleteMessage=u;e.InfoMessage=c;e.InitMessage=o;e.Message=a;e.ShaderMessage=d;e.ShowCachedMessage=w;e.ShowMessage=p;e.UniformsMessage=h;e.WipeMessage=f;Object.defineProperty(e,"__esModule",{value:true})}));